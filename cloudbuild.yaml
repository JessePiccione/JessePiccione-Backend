options: 
  logging: CLOUD_LOGGING_ONLY
steps:
- name: 'gcr.io/cloud-builders/docker'
  args: ['build', '.', '-t', 'gcr.io/piccione-dev/portal:$BUILD_ID']
- name: 'gcr.io/cloud-builders/docker'
  args: ['push', 'gcr.io/piccione-dev/portal:$BUILD_ID']
- name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
  entrypoint: 'gcloud'
  args:
    - run
    - deploy
    - portal-piccione-dev
    - --region 
    - us-east1
    - --image
    - gcr.io/piccione-dev/portal:$BUILD_ID
    - --set-secrets
    - SECRET_KEY_VAR=SECRET_KEY_VAR
    - OPENAI_API_KEY=OPENAI_API_KEY
    - DATABASE_ENGINE=DATABASE_ENGINE
    - DATABASE_HOST=DATABASE_HOST
    - DATABASE_NAME=DATABASE_NAME
    - DATABASE_PORT=DATABASE_PORT
    - DATABASE_USERNAME=DATABASE_USERNAME
    - DATABASE_PASSWORD=DATABASE_PASSWORD